var g=Object.defineProperty;var p=(a,e,s)=>e in a?g(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s;var t=(a,e,s)=>(p(a,typeof e!="symbol"?e+"":e,s),s);import{u as l}from"./index.6288c2d7.js";import{m as u,b as d,o as _,d as c,j as n,I as h,B as f}from"./vendor.305c6c80.js";import{c as m}from"./index.19065902.js";class k{constructor(e){t(this,"url");t(this,"conn");t(this,"loading",!1);t(this,"data","");t(this,"uuid","");t(this,"status",0);var s,i;u(this),this.Update({url:e.url}),this.init(),this.data=(s=e.user.token)!=null?s:"",this.uuid=(i=e.user.uuid)!=null?i:""}init(){this.conn=new WebSocket(this.url||""),this.conn.onopen=e=>{this.status||this.onSend({token:this.data,user_id:this.uuid});const s=e.currentTarget;this.status=s.readyState},this.StepLogin()}StepLogin(){this.onMeassge()}watchState(){this.status===3&&this.onClose()}onMeassge(){if(!this.conn)return console.error("\u8FD8\u672A\u521B\u5EFAsocket\u5B9E\u5217");this.conn.onmessage=e=>{const s=e.currentTarget;this.status=s.readyState}}onSend(e){if(!this.conn)return console.error("\u8FD8\u672A\u521B\u5EFAsocket\u5B9E\u5217");this.conn.send(JSON.stringify(e))}onClose(){var e;(e=this.conn)==null||e.close(),this.loading=!1}Heartbeat(){}Update(e){d(()=>Object.assign(this,e))}}class v{constructor({events:e,routers:s,user:i}){t(this,"name","");t(this,"routers");t(this,"events");t(this,"user");t(this,"ws");t(this,"send","");t(this,"receive_id","");t(this,"$$");this.updateData({routers:s,events:e,user:i,$$:e}),u(this),this.ws=new k({url:"ws://127.0.0.1:8081/api/ws",user:this.user}),this.getKeys()}async getKeys(){const e=await m("/api/home/key",{reqData:void 0,params:{id:1},method:"get"});e.mgsCode===200&&(sessionStorage.setItem("private",e.body.private),sessionStorage.setItem("public",e.body.public))}handleClick(){var e;(e=this.routers)==null||e.navigate("/admin")}handleSendWsData(){var e;(e=this.ws)==null||e.onSend({receive_id:this.receive_id,message:this.send})}handleAddUser(){var e;(e=this.routers)==null||e.navigate("/add_user")}updateData(e){d(()=>{Object.assign(this,e)})}}const B="_HomeMain_1754d_1",S="_homeHeader_1754d_1",D="_rightBlock_1754d_6",b="_leftBlock_1754d_10",y="_leftIcon_1754d_14",A="_addNum_1754d_17";var o={HomeMain:B,homeHeader:S,rightBlock:D,leftBlock:b,leftIcon:y,addNum:A};class C{constructor({events:e,routers:s,user:i}){t(this,"user");t(this,"list");this.update({user:i}),u(this),this.getUserApply()}async getUserApply(){var s;const e=await m("/api/chum/apply",{params:{id:((s=this.user)==null?void 0:s.uuid)||""},reqData:void 0,method:"get"});e.mgsCode===200&&(this.list=e.body)}update(e){d(()=>{Object.assign(this,e)})}}var I=_(()=>{var s,i;const a=l(v),e=l(C);return c("div",{className:o.HomeMain,children:[c("div",{className:o.homeHeader,children:[c("div",{className:o.leftBlock,children:[n("i",{className:"iconfont icon-geren "+o.leftIcon,onClick:()=>a.handleAddUser()}),n("span",{className:o.addNum,children:((s=e.list)==null?void 0:s.length)||0})]}),n("div",{className:o.rightBlock,children:n("i",{className:"iconfont icon-jia",onClick:()=>a.handleAddUser()})})]}),"test ",(i=a.routers)==null?void 0:i.path,n("div",{onClick:()=>a.handleClick(),children:"\u70B9\u6211\u8DF3\u5230\u7BA1\u7406\u9875"}),n(h,{placeholder:"\u63A5\u53D7\u8005ID",onChange:r=>a.updateData({receive_id:r})}),n(h,{placeholder:"\u8F93\u5165\u53D1\u9001\u7684\u6D88\u606F",onChange:r=>a.updateData({send:r})}),n(f,{onClick:()=>a.handleSendWsData(),children:"\u70B9\u51FB\u53D1\u9001\u6D88\u606F"})]})});export{I as default};
