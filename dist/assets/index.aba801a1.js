var c=Object.defineProperty;var h=(a,e,s)=>e in a?c(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s;var t=(a,e,s)=>(h(a,typeof e!="symbol"?e+"":e,s),s);import{u as l}from"./index.0be79017.js";import{m as r,b as u,o as m,d as g,j as i,I as d,B as p}from"./vendor.0d2e9121.js";import{c as v}from"./index.d41693ee.js";class f{constructor(e){t(this,"url");t(this,"conn");t(this,"loading",!1);t(this,"data","");t(this,"uuid","");t(this,"status",0);var s,n;r(this),this.Update({url:e.url}),this.init(),this.data=(s=e.user.token)!=null?s:"",this.uuid=(n=e.user.uuid)!=null?n:""}init(){this.conn=new WebSocket(this.url||""),this.conn.onopen=e=>{this.status||this.onSend({token:this.data,user_id:this.uuid});const s=e.currentTarget;this.status=s.readyState},this.StepLogin()}StepLogin(){this.onMeassge()}watchState(){this.status===3&&this.onClose()}onMeassge(){if(!this.conn)return console.error("\u8FD8\u672A\u521B\u5EFAsocket\u5B9E\u5217");this.conn.onmessage=e=>{const s=e.currentTarget;this.status=s.readyState}}onSend(e){if(!this.conn)return console.error("\u8FD8\u672A\u521B\u5EFAsocket\u5B9E\u5217");this.conn.send(JSON.stringify(e))}onClose(){var e;(e=this.conn)==null||e.close(),this.loading=!1}Heartbeat(){}Update(e){u(()=>Object.assign(this,e))}}class k{constructor({events:e,routers:s,user:n}){t(this,"name","");t(this,"routers");t(this,"events");t(this,"user");t(this,"ws");t(this,"send","");t(this,"receive_id","");t(this,"$$");this.updateData({routers:s,events:e,user:n,$$:e}),r(this),this.ws=new f({url:"ws://127.0.0.1:8081/api/ws",user:this.user}),this.getKeys()}async getKeys(){const e=await v("/api/home/key",{reqData:void 0,params:{id:1},method:"get"});e.mgsCode===200&&(sessionStorage.setItem("private",e.body.private),sessionStorage.setItem("public",e.body.public))}handleClick(){var e;(e=this.routers)==null||e.navigate("/admin")}handleSendWsData(){var e;(e=this.ws)==null||e.onSend({receive_id:this.receive_id,message:this.send})}handleAddUser(){var e;(e=this.routers)==null||e.navigate("/add_user")}updateData(e){u(()=>{Object.assign(this,e)})}}const S="_HomeMain_76i05_1",D="_homeHeader_76i05_1",_="_leftBlock_76i05_6";var o={HomeMain:S,homeHeader:D,leftBlock:_},y=m(()=>{var e;const a=l(k);return g("div",{className:o.HomeMain,children:[i("div",{className:o.homeHeader,children:i("div",{className:o.leftBlock,children:i("i",{className:"iconfont icon-jia",onClick:()=>a.handleAddUser()})})}),"test ",(e=a.routers)==null?void 0:e.path,i("div",{onClick:()=>a.handleClick(),children:"\u70B9\u6211\u8DF3\u5230\u7BA1\u7406\u9875"}),i(d,{placeholder:"\u63A5\u53D7\u8005ID",onChange:s=>a.updateData({receive_id:s})}),i(d,{placeholder:"\u8F93\u5165\u53D1\u9001\u7684\u6D88\u606F",onChange:s=>a.updateData({send:s})}),i(p,{onClick:()=>a.handleSendWsData(),children:"\u70B9\u51FB\u53D1\u9001\u6D88\u606F"})]})});export{y as default};
